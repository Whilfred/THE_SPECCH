<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>THE SPEECH - Commande en ligne</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

<div class="bg-white rounded-2xl shadow-xl w-full max-w-5xl p-6 grid md:grid-cols-2 gap-8">

  <!-- MENU -->
  <div>
    <h1 class="text-3xl font-bold mb-2 text-yellow-600">Caf√©t√©ria THE SPEECH</h1>
    <p class="mb-6 text-gray-600">Choisis ton plat et d√©couvre les d√©tails üëá</p>

    <div class="grid sm:grid-cols-2 gap-4">

      <!-- PLAT -->
      <div class="border rounded-xl shadow overflow-hidden transition-all duration-300">
        <img src="assets/poulet-au-riz.jpeg" class="w-full h-40 object-cover">
        <div class="p-3 space-y-2">
          <h3 class="font-semibold">Riz + poulet</h3>
          <p class="text-sm text-gray-600">Riz blanc accompagn√© de poulet savoureux.</p>

          <!-- DESCRIPTION LONGUE -->
          <p class="text-sm text-gray-700 hidden">
            Riz bien cuit accompagn√© de poulet tendre et bien assaisonn√©, servi chaud avec sauce.
          </p>

          <div class="flex justify-between items-center">
            <button class="text-yellow-600 text-sm font-semibold toggle-btn">
              Voir plus
            </button>
            <input type="checkbox" value="Riz + poulet - 2000 F" class="plat">
          </div>
        </div>
      </div>

      <div class="border rounded-xl shadow overflow-hidden transition-all duration-300">
        <img src="assets/Attike_poisson.webp" class="w-full h-40 object-cover">
        <div class="p-3 space-y-2">
          <h3 class="font-semibold">Atti√©k√© + poisson</h3>
          <p class="text-sm text-gray-600">Atti√©k√© frais avec poisson grill√©.</p>

          <p class="text-sm text-gray-700 hidden">
            Atti√©k√© frais accompagn√© de poisson brais√©, oignons, tomates et piment.
          </p>

          <div class="flex justify-between items-center">
            <button class="text-yellow-600 text-sm font-semibold toggle-btn">
              Voir plus
            </button>
            <input type="checkbox" value="Atti√©k√© + poisson - 1500 F" class="plat">
          </div>
        </div>
      </div>

      <div class="border rounded-xl shadow overflow-hidden transition-all duration-300">
        <img src="assets/frite_au_poulet.jpg" class="w-full h-40 object-cover">
        <div class="p-3 space-y-2">
          <h3 class="font-semibold">Frite au poulet</h3>
          <p class="text-sm text-gray-600">Frites croustillantes avec poulet dor√©.</p>

          <p class="text-sm text-gray-700 hidden">
            Frites bien croustillantes accompagn√©es de poulet assaisonn√© et grill√©.
          </p>

          <div class="flex justify-between items-center">
            <button class="text-yellow-600 text-sm font-semibold toggle-btn">
              Voir plus
            </button>
            <input type="checkbox" value="Frite au poulet - 2500 F" class="plat">
          </div>
        </div>
      </div>

      <div class="border rounded-xl shadow overflow-hidden transition-all duration-300">
        <img src="assets/chawarma.jpg" class="w-full h-40 object-cover">
        <div class="p-3 space-y-2">
          <h3 class="font-semibold">Chawarma</h3>
          <p class="text-sm text-gray-600">Sandwich chawarma bien garni.</p>

          <p class="text-sm text-gray-700 hidden">
            Chawarma bien garni avec viande, l√©gumes frais et sauce sp√©ciale maison.
          </p>

          <div class="flex justify-between items-center">
            <button class="text-yellow-600 text-sm font-semibold toggle-btn">
              Voir plus
            </button>
            <input type="checkbox" value="Chawarma - 1500 F" class="plat">
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- FORMULAIRE -->
  <div>
    <h2 class="text-xl font-semibold mb-4">Validation de commande</h2>

    <form id="orderForm" class="space-y-4">
      <input name="full_name" placeholder="Nom complet" required class="w-full border p-2">
      <input name="email" placeholder="Email" required class="w-full border p-2">
      <input name="phone" placeholder="T√©l√©phone" required class="w-full border p-2">
      <input name="payment_image" type="file" required accept="image/*">
      <textarea id="resume" readonly class="w-full border p-2 bg-gray-50"></textarea>

      <button class="w-full bg-yellow-600 text-white p-3 rounded-xl">
        Valider la commande
      </button>
    </form>

    <p id="success" class="text-green-600 mt-4 hidden">
      ‚úÖ Commande envoy√©e avec succ√®s !
    </p>
  </div>

</div>

<script>
const plats = document.querySelectorAll('.plat');
const resume = document.getElementById('resume');
const form = document.getElementById('orderForm');

// gestion s√©lection plats
plats.forEach(p => {
  p.addEventListener('change', () => {
    const selected = [];
    plats.forEach(item => item.checked && selected.push(item.value));
    resume.value = selected.join('\n');
  });
});

// voir plus / masquer
document.querySelectorAll('.toggle-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    const card = btn.closest('.p-3');
    const desc = card.querySelectorAll('p')[1];

    desc.classList.toggle('hidden');
    btn.textContent = desc.classList.contains('hidden') ? 'Voir plus' : 'Masquer';
  });
});

// envoi commande
form.addEventListener('submit', (e) => {
  e.preventDefault();
  const file = form.payment_image.files[0];
  if (!file) return alert('Image requise');

  const reader = new FileReader();
  reader.onload = async () => {
    const payload = {
      full_name: form.full_name.value,
      email: form.email.value,
      phone: form.phone.value,
      order_details: resume.value,
      payment_image: reader.result
    };

    try {
      const response = await fetch('https://the-specch-1.onrender.com/api/orders', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });

      const data = await response.json();
      if (response.status !== 201) return alert(data.message);

      document.getElementById('success').classList.remove('hidden');
      form.reset();
      resume.value = '';
    } catch {
      alert('Erreur lors de l‚Äôenvoi de la commande');
    }
  };
  reader.readAsDataURL(file);
});
</script>

</body>
</html>
