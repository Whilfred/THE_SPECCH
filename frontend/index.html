<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>THE SPEECH - Commande en ligne</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
  <div class="bg-white rounded-2xl shadow-xl w-full max-w-5xl p-6 grid md:grid-cols-2 gap-8">

    <!-- MENU -->
    <div>
      <h1 class="text-3xl font-bold mb-2 text-yellow-600">Caf√©t√©ria THE SPEECH</h1>
      <p class="mb-6 text-gray-600">Choisis ton plat et d√©couvre les d√©tails üëá</p>

      <div class="grid sm:grid-cols-2 gap-4">

        <!-- Plat 1 -->
        <div class="border rounded-xl overflow-hidden shadow hover:shadow-lg transition">
          <img src="assets/poulet-au-riz.jpeg" alt="Riz poulet" class="w-full h-40 object-cover">
          <div class="p-3">
            <div class="flex justify-between items-center">
              <h3 class="font-semibold">Riz + poulet</h3>
              <input type="checkbox" value="Riz + poulet - 2000 F" class="plat">
            </div>
          </div>
        </div>

        <!-- Plat 2 -->
        <div class="border rounded-xl overflow-hidden shadow hover:shadow-lg transition">
          <img src="assets/Attike_poisson.webp" alt="Atti√©k√© poisson" class="w-full h-40 object-cover">
          <div class="p-3">
            <div class="flex justify-between items-center">
              <h3 class="font-semibold">Atti√©k√© + poisson</h3>
              <input type="checkbox" value="Atti√©k√© + poisson - 1500 F" class="plat">
            </div>
          </div>
        </div>

        <!-- Plat 3 -->
        <div class="border rounded-xl overflow-hidden shadow hover:shadow-lg transition">
          <img src="assets/frite_au_poulet.jpg" alt="Frite poulet" class="w-full h-40 object-cover">
          <div class="p-3">
            <div class="flex justify-between items-center">
              <h3 class="font-semibold">Frite au poulet</h3>
              <input type="checkbox" value="Frite au poulet - 2500 F" class="plat">
            </div>
          </div>
        </div>

        <!-- Plat 4 -->
        <div class="border rounded-xl overflow-hidden shadow hover:shadow-lg transition">
          <img src="assets/chawarma.jpg" alt="Chawarma" class="w-full h-40 object-cover">
          <div class="p-3">
            <div class="flex justify-between items-center">
              <h3 class="font-semibold">Chawarma</h3>
              <input type="checkbox" value="Chawarma - 1500 F" class="plat">
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- FORMULAIRE -->
    <div>
      <h2 class="text-xl font-semibold mb-4">Validation de commande</h2>

      <form
        id="orderForm"
        class="space-y-4"
        enctype="multipart/form-data"
      >

        <div>
          <label class="block text-sm font-medium">Nom complet</label>
          <input name="full_name" required type="text" class="w-full border rounded-lg p-2">
        </div>

        <div>
          <label class="block text-sm font-medium">Email</label>
          <input name="email" required type="email" class="w-full border rounded-lg p-2">
        </div>

        <div>
          <label class="block text-sm font-medium">T√©l√©phone</label>
          <input name="phone" required type="tel" class="w-full border rounded-lg p-2">
        </div>

        <div>
          <label class="block text-sm font-medium">Photo du paiement</label>
          <input name="payment_image" required type="file" accept="image/*">
        </div>

        <div>
          <label class="block text-sm font-medium">Commande s√©lectionn√©e</label>
          <textarea
            name="order_details"
            id="resume"
            readonly
            class="w-full border rounded-lg p-2 bg-gray-50"
          ></textarea>
        </div>

        <button
          type="submit"
          class="w-full bg-yellow-600 text-white p-3 rounded-xl hover:bg-yellow-700 transition"
        >
          Valider la commande
        </button>
      </form>

      <p id="success" class="text-green-600 mt-4 hidden">
        ‚úÖ Commande envoy√©e avec succ√®s !
      </p>
    </div>
  </div>
<script>
const plats = document.querySelectorAll('.plat');
const resume = document.getElementById('resume');
const form = document.getElementById('orderForm');

plats.forEach(p => {
  p.addEventListener('change', () => {
    const selected = [];
    plats.forEach(item => {
      if (item.checked) selected.push(item.value);
    });
    resume.value = selected.join('\n');
    console.log('Plats s√©lectionn√©s :', resume.value); // LOG
  });
});

form.addEventListener('submit', async (e) => {
  e.preventDefault();

  const formData = new FormData(form);

  try {
    const response = await fetch('http://localhost:5000/api/orders', {
      method: 'POST',
      body: formData
    });

    console.log('Status HTTP:', response.status);
    console.log('Status OK:', response.ok);

    const data = await response.json();
    console.log('R√©ponse serveur :', data);

    // On ne se fie plus uniquement √† response.ok
    if (response.status !== 201) {
      console.error('Erreur c√¥t√© serveur :', data.message);
      throw new Error(data.message || 'Erreur inconnue');
    }

    document.getElementById('success').classList.remove('hidden');
    form.reset();
    resume.value = '';

  } catch (err) {
  }
});
</script>


</body>
</html>
