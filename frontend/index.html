<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>THE SPEECH - Commande en ligne</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
  <div class="bg-white rounded-2xl shadow-xl w-full max-w-5xl p-6 grid md:grid-cols-2 gap-8">

    <!-- MENU -->
    <div>
      <h1 class="text-3xl font-bold mb-2 text-yellow-600">CafÃ©tÃ©ria THE SPEECH</h1>
      <p class="mb-6 text-gray-600">Choisis ton plat et dÃ©couvre les dÃ©tails ğŸ‘‡</p>

      <div class="grid sm:grid-cols-2 gap-4">
        <div class="border rounded-xl overflow-hidden shadow">
          <img src="assets/poulet-au-riz.jpeg" class="w-full h-40 object-cover">
          <div class="p-3 flex justify-between">
            <h3>Riz + poulet</h3>
            <input type="checkbox" value="Riz + poulet - 2000 F" class="plat">
          </div>
        </div>

        <div class="border rounded-xl overflow-hidden shadow">
          <img src="assets/Attike_poisson.webp" class="w-full h-40 object-cover">
          <div class="p-3 flex justify-between">
            <h3>AttiÃ©kÃ© + poisson</h3>
            <input type="checkbox" value="AttiÃ©kÃ© + poisson - 1500 F" class="plat">
          </div>
        </div>

        <div class="border rounded-xl overflow-hidden shadow">
          <img src="assets/frite_au_poulet.jpg" class="w-full h-40 object-cover">
          <div class="p-3 flex justify-between">
            <h3>Frite au poulet</h3>
            <input type="checkbox" value="Frite au poulet - 2500 F" class="plat">
          </div>
        </div>

        <div class="border rounded-xl overflow-hidden shadow">
          <img src="assets/chawarma.jpg" class="w-full h-40 object-cover">
          <div class="p-3 flex justify-between">
            <h3>Chawarma</h3>
            <input type="checkbox" value="Chawarma - 1500 F" class="plat">
          </div>
        </div>
      </div>
    </div>

    <!-- FORMULAIRE -->
    <div>
      <h2 class="text-xl font-semibold mb-4">Validation de commande</h2>

      <form id="orderForm" class="space-y-4">
        <input name="full_name" placeholder="Nom complet" required class="w-full border p-2">
        <input name="email" placeholder="Email" required class="w-full border p-2">
        <input name="phone" placeholder="TÃ©lÃ©phone" required class="w-full border p-2">
        <input name="payment_image" type="file" required accept="image/*">
        <textarea id="resume" readonly class="w-full border p-2 bg-gray-50"></textarea>

        <button class="w-full bg-yellow-600 text-white p-3 rounded-xl">
          Valider la commande
        </button>
      </form>

      <p id="success" class="text-green-600 mt-4 hidden">
        âœ… Commande envoyÃ©e avec succÃ¨s !
      </p>
    </div>
  </div>
<script>
const plats = document.querySelectorAll('.plat');
const resume = document.getElementById('resume');
const form = document.getElementById('orderForm');

// Mise Ã  jour des plats sÃ©lectionnÃ©s
plats.forEach((p) => {
  p.addEventListener('change', () => {
    const selected = [];
    plats.forEach((item) => {
      if (item.checked) {
        selected.push(item.value);
      }
    });
    resume.value = selected.join('\n');
    console.log('ğŸ§¾ Plats sÃ©lectionnÃ©s:', resume.value);
  });
});

// Soumission du formulaire
form.addEventListener('submit', (e) => {
  e.preventDefault();

  const fileInput = form.payment_image;
  const file = fileInput.files[0];

  console.log('ğŸ“· Fichier image:', file);

  if (!file) {
    alert('Image requise');
    return;
  }

  const reader = new FileReader();

  reader.onload = async function () {
    const payload = {
      full_name: form.full_name.value,
      email: form.email.value,
      phone: form.phone.value,
      order_details: resume.value,
      payment_image: reader.result
    };

    console.log('ğŸ“¤ PAYLOAD ENVOYÃ‰:', payload);
    console.log('ğŸ“ Taille image Base64:', payload.payment_image.length);

    try {
      const response = await fetch('https://the-specch-1.onrender.com/api/orders', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(payload)
      });

      console.log('ğŸ“¥ HTTP STATUS:', response.status);

      const data = await response.json();
      console.log('ğŸ“¥ RÃ‰PONSE BACKEND:', data);

      if (response.status !== 201) {
        alert(data.message || 'Erreur serveur');
        return;
      }

      document.getElementById('success').classList.remove('hidden');
      form.reset();
      resume.value = '';

    } catch (error) {
      console.error('âŒ Erreur FETCH:', error);
      alert('Erreur lors de lâ€™envoi de la commande');
    }
  };

  reader.readAsDataURL(file);
});
</script>


</body>
</html>
